[gd_scene load_steps=32 format=3 uid="uid://bfglvthi078c4"]

[ext_resource type="Script" uid="uid://dkp3jriuu0cky" path="res://scripts/cpr_minigame.gd" id="1_2jrgg"]
[ext_resource type="Texture2D" uid="uid://dj6fcacto53g7" path="res://sprites/ui/red_bar.png" id="2_40qy3"]
[ext_resource type="Texture2D" uid="uid://bya8w41doxmau" path="res://sprites/ui/green_zone.png" id="3_m50jn"]
[ext_resource type="Texture2D" uid="uid://bitwyhe01qo6a" path="res://sprites/ui/marker_line.png" id="4_xfdd2"]
[ext_resource type="Shader" uid="uid://cbhv46lewf3ye" path="res://sprites/inside_ambulance.gdshader" id="5_40qy3"]
[ext_resource type="Shader" uid="uid://d0a4cx3l201jt" path="res://sprites/grass.gdshader" id="6_xfdd2"]
[ext_resource type="Texture2D" uid="uid://dn2uqln2pcfko" path="res://sprites/seamlessbw.png" id="7_2l54m"]
[ext_resource type="Texture2D" uid="uid://bnlwn8xhx67vm" path="res://sprites/ui/infection_bar_sheet.png" id="8_2l54m"]
[ext_resource type="AudioStream" uid="uid://b3mgeflmb14ua" path="res://sounds/heartbeats-61.mp3" id="9_lqg2v"]
[ext_resource type="Shader" uid="uid://cdaghx2ghqgri" path="res://shaders/heartbeat.gdshader" id="10_8p4xw"]
[ext_resource type="Texture2D" uid="uid://c3ufenux1hnva" path="res://sprites/ui/health_bar.png" id="11_4hrb3"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_2l54m"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_m50jn"]
size = Vector2(11, 15)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_2jrgg"]
size = Vector2(4, 15)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_40qy3"]
size = Vector2(2, 15)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_4hrb3"]
shader = ExtResource("6_xfdd2")
shader_parameter/scale = Vector2(0.2, 0.2)
shader_parameter/strength = 0.2
shader_parameter/fps = 6.0
shader_parameter/noise = ExtResource("7_2l54m")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_2jrgg"]
shader = ExtResource("5_40qy3")
shader_parameter/overlay = true
shader_parameter/scanlines_opacity = 0.4
shader_parameter/scanlines_width = 0.25
shader_parameter/grille_opacity = 0.3
shader_parameter/resolution = Vector2(640, 480)
shader_parameter/pixelate = true
shader_parameter/roll = false
shader_parameter/roll_speed = 8.0
shader_parameter/roll_size = 0.0
shader_parameter/roll_variation = 1.8
shader_parameter/distort_intensity = 0.05
shader_parameter/noise_opacity = 0.4
shader_parameter/noise_speed = 5.0
shader_parameter/static_noise_intensity = 0.06
shader_parameter/aberration = 4.7499999933364734e-08
shader_parameter/brightness = 1.4
shader_parameter/discolor = false
shader_parameter/warp_amount = 0.0
shader_parameter/clip_warp = false
shader_parameter/vignette_intensity = 0.4
shader_parameter/vignette_opacity = 0.5

[sub_resource type="ShaderMaterial" id="ShaderMaterial_tguor"]
shader = ExtResource("6_xfdd2")
shader_parameter/scale = Vector2(1, 1)
shader_parameter/strength = 1.0
shader_parameter/fps = 6.0
shader_parameter/noise = ExtResource("7_2l54m")

[sub_resource type="AtlasTexture" id="AtlasTexture_8h437"]
atlas = ExtResource("8_2l54m")
region = Rect2(864, 0, 108, 14)

[sub_resource type="AtlasTexture" id="AtlasTexture_swde8"]
atlas = ExtResource("8_2l54m")
region = Rect2(756, 0, 108, 14)

[sub_resource type="AtlasTexture" id="AtlasTexture_mc4bw"]
atlas = ExtResource("8_2l54m")
region = Rect2(648, 0, 108, 14)

[sub_resource type="AtlasTexture" id="AtlasTexture_tguor"]
atlas = ExtResource("8_2l54m")
region = Rect2(540, 0, 108, 14)

[sub_resource type="AtlasTexture" id="AtlasTexture_os4ng"]
atlas = ExtResource("8_2l54m")
region = Rect2(432, 0, 108, 14)

[sub_resource type="AtlasTexture" id="AtlasTexture_scwem"]
atlas = ExtResource("8_2l54m")
region = Rect2(324, 0, 108, 14)

[sub_resource type="AtlasTexture" id="AtlasTexture_4rjsk"]
atlas = ExtResource("8_2l54m")
region = Rect2(216, 0, 108, 14)

[sub_resource type="AtlasTexture" id="AtlasTexture_x0ft1"]
atlas = ExtResource("8_2l54m")
region = Rect2(108, 0, 108, 14)

[sub_resource type="AtlasTexture" id="AtlasTexture_nixtb"]
atlas = ExtResource("8_2l54m")
region = Rect2(0, 0, 108, 14)

[sub_resource type="SpriteFrames" id="SpriteFrames_rcnul"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_8h437")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_swde8")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_mc4bw")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_tguor")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_os4ng")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_scwem")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_4rjsk")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_x0ft1")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_nixtb")
}],
"loop": true,
"name": &"default",
"speed": 1.0
}]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_os4ng"]
shader = ExtResource("5_40qy3")
shader_parameter/overlay = true
shader_parameter/scanlines_opacity = 0.4
shader_parameter/scanlines_width = 0.25
shader_parameter/grille_opacity = 0.3
shader_parameter/resolution = Vector2(640, 480)
shader_parameter/pixelate = true
shader_parameter/roll = false
shader_parameter/roll_speed = 8.0
shader_parameter/roll_size = 0.0
shader_parameter/roll_variation = 1.8
shader_parameter/distort_intensity = 0.05
shader_parameter/noise_opacity = 0.4
shader_parameter/noise_speed = 5.0
shader_parameter/static_noise_intensity = 0.06
shader_parameter/aberration = 4.7499999933364734e-08
shader_parameter/brightness = 1.4
shader_parameter/discolor = false
shader_parameter/warp_amount = 0.0
shader_parameter/clip_warp = false
shader_parameter/vignette_intensity = 0.4
shader_parameter/vignette_opacity = 0.5

[sub_resource type="ShaderMaterial" id="ShaderMaterial_swde8"]
shader = ExtResource("6_xfdd2")
shader_parameter/scale = Vector2(1, 1)
shader_parameter/strength = 1.0
shader_parameter/fps = 6.0
shader_parameter/noise = ExtResource("7_2l54m")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_8liec"]
shader = ExtResource("10_8p4xw")
shader_parameter/beat_speed = 0.99000004376512
shader_parameter/pulse_strength = 0.050000002375
shader_parameter/pulse_mode = 2

[node name="CPR_minigame" type="Node2D"]
script = ExtResource("1_2jrgg")

[node name="RedBar" type="Sprite2D" parent="."]
unique_name_in_owner = true
material = SubResource("ShaderMaterial_2l54m")
texture = ExtResource("2_40qy3")

[node name="GreenZone" type="Sprite2D" parent="."]
unique_name_in_owner = true
texture = ExtResource("3_m50jn")

[node name="green_area" type="Area2D" parent="GreenZone"]
unique_name_in_owner = true

[node name="CollisionShape2D" type="CollisionShape2D" parent="GreenZone/green_area"]
shape = SubResource("RectangleShape2D_m50jn")

[node name="Camera2D" type="Camera2D" parent="."]
zoom = Vector2(3, 3)

[node name="area_left" type="Area2D" parent="."]
position = Vector2(-53, 0)

[node name="CollisionShape2D" type="CollisionShape2D" parent="area_left"]
shape = SubResource("RectangleShape2D_2jrgg")

[node name="area_right" type="Area2D" parent="."]
position = Vector2(53, 0)

[node name="CollisionShape2D" type="CollisionShape2D" parent="area_right"]
shape = SubResource("RectangleShape2D_2jrgg")

[node name="MarkerLine" type="Sprite2D" parent="." groups=["marker"]]
unique_name_in_owner = true
z_index = 1
texture = ExtResource("4_xfdd2")

[node name="character_marker" type="CharacterBody2D" parent="MarkerLine" groups=["marker"]]

[node name="CollisionShape2D" type="CollisionShape2D" parent="MarkerLine/character_marker" groups=["marker"]]
shape = SubResource("RectangleShape2D_40qy3")

[node name="tutorial_label" type="Label" parent="."]
offset_left = -109.0
offset_top = 69.0
offset_right = 253.0
offset_bottom = 134.0
theme_override_font_sizes/font_size = 10
text = "To perform CPR: 
- press space while in green
- try to avoid hitting the red (it will hurt them)
"

[node name="debug_label" type="Label" parent="."]
offset_left = -85.0
offset_top = -36.0
offset_right = 277.0
offset_bottom = 29.0
theme_override_font_sizes/font_size = 10

[node name="parasite_label" type="Label" parent="."]
material = SubResource("ShaderMaterial_4hrb3")
offset_left = -109.0
offset_top = 103.0
offset_right = 253.0
offset_bottom = 134.0
theme_override_font_sizes/font_size = 10
text = "
- ask for help if you need it :)"

[node name="ColorRect" type="ColorRect" parent="."]
material = SubResource("ShaderMaterial_2jrgg")
offset_left = -54.999996
offset_top = -7.0
offset_right = -14.999996
offset_bottom = 33.0
scale = Vector2(2.7665863, 0.35424906)
color = Color(1, 1, 1, 0.41960785)

[node name="infection_bar" type="Node2D" parent="."]
position = Vector2(200, 0)

[node name="infection_animation" type="AnimatedSprite2D" parent="infection_bar"]
unique_name_in_owner = true
material = SubResource("ShaderMaterial_tguor")
position = Vector2(-1, -1)
scale = Vector2(1.0331105, 1)
sprite_frames = SubResource("SpriteFrames_rcnul")
frame_progress = 0.9435673

[node name="CanvasLayer" type="CanvasLayer" parent="infection_bar"]

[node name="ColorRect" type="ColorRect" parent="infection_bar"]
material = SubResource("ShaderMaterial_os4ng")
offset_left = -56.0
offset_top = -8.0
offset_right = -16.0
offset_bottom = 32.0
scale = Vector2(2.7665863, 0.35424906)
mouse_filter = 2
color = Color(1, 1, 1, 0.1764706)

[node name="let_us_help" type="Button" parent="infection_bar"]
material = SubResource("ShaderMaterial_swde8")
offset_left = -39.0
offset_top = 11.999992
offset_right = 65.0
offset_bottom = 42.999992
scale = Vector2(0.7489059, 0.64704967)
theme_override_colors/icon_normal_color = Color(1, 1, 1, 1)
text = "LET US HELP"

[node name="ColorRect2" type="ColorRect" parent="infection_bar/let_us_help"]
visible = false
material = SubResource("ShaderMaterial_os4ng")
layout_mode = 0
offset_left = 1.3352833
offset_top = -1.1444092e-05
offset_right = 41.33528
offset_bottom = 39.99999
scale = Vector2(2.5723014, 0.82314897)
mouse_filter = 1

[node name="heartbeat_audio" type="AudioStreamPlayer" parent="."]
stream = ExtResource("9_lqg2v")

[node name="health_bar" type="TextureProgressBar" parent="."]
material = SubResource("ShaderMaterial_8liec")
offset_left = 403.00003
offset_top = -132.00002
offset_right = 762.9999
offset_bottom = -68.000015
rotation = 1.5710795
scale = Vector2(0.87559414, 9.601801)
mouse_filter = 2
step = 0.01
value = 100.0
fill_mode = 3
texture_progress = ExtResource("11_4hrb3")

[node name="health_timer" type="Timer" parent="."]
wait_time = 100.0
one_shot = true
autostart = true

[connection signal="body_entered" from="GreenZone/green_area" to="." method="_on_green_area_body_entered"]
[connection signal="body_exited" from="GreenZone/green_area" to="." method="_on_green_area_body_exited"]
[connection signal="body_entered" from="area_left" to="." method="_on_area_left_body_entered"]
[connection signal="body_entered" from="area_right" to="." method="_on_area_right_body_entered"]
[connection signal="pressed" from="infection_bar/let_us_help" to="." method="_on_let_us_help_pressed"]
[connection signal="finished" from="heartbeat_audio" to="." method="_on_heartbeat_audio_finished"]
